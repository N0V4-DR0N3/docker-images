# =============================================================================
# Caddyfile para Laravel + FrankenPHP (modo classic/fallback)
# =============================================================================
# Este Caddyfile é usado quando o Laravel Octane NÃO está instalado.
# Quando Octane está instalado, o entrypoint usa `php artisan octane:frankenphp`
# que gerencia sua própria configuração do servidor.
# =============================================================================

{
    # Desabilitar admin API em produção
    admin off
    
    # Logs
    log {
        output stderr
        format console
    }
}

# Servidor principal
:80, :443 {
    # Diretório raiz da aplicação Laravel
    root * /app/public
    
    # Codificação (compressão)
    encode zstd br gzip
    
    # Headers de segurança
    header {
        # Proteção contra XSS
        X-Content-Type-Options "nosniff"
        X-Frame-Options "SAMEORIGIN"
        X-XSS-Protection "1; mode=block"
        
        # Remover headers que expõem informações
        -Server
        -X-Powered-By
    }
    
    # Arquivos estáticos com cache
    @static {
        file
        path *.ico *.css *.js *.gif *.jpg *.jpeg *.png *.svg *.woff *.woff2 *.ttf *.eot
    }
    header @static Cache-Control "public, max-age=31536000, immutable"
    
    # Servir arquivos estáticos
    file_server
    
    # Roteamento Laravel
    php_server
    
    # Logs de acesso
    log {
        output stderr
        format console
    }
}
